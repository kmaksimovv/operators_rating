{% extends "base.html" %}

{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"></script>

  <canvas id="сhart" width="600" height="200"></canvas>
  <button id="save-image-btn" class="btn btn-success">Сохранить</button>
  <script>
    Chart.plugins.register({
      beforeDraw: function(chartInstance) {
        var ctx = chartInstance.chart.ctx;
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, chartInstance.chart.width, chartInstance.chart.height);
      }
    });
    var ctx = document.getElementById('сhart').getContext("2d");
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels:[
        {% for item in labels %}
        "{{ item }}",
        {% endfor %}
        ],
        datasets: [{
          data : [
          {% for item in values %}
          "{{ item }}",
          {% endfor %}
          ],
          backgroundColor: 'rgba(33, 145, 81, 0.2)',
          borderColor: 'rgba(255, 134, 25, 1)',
          borderWidth: 2,
          label: 'ОЦЕНКА',
          maxBarThickness: 30,
        }]
      },
      
      options: {
        animation: {
          onComplete: function () {
            var ctx = this.chart.ctx;
            ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontFamily, 'normal', Chart.defaults.global.defaultFontFamily);
            ctx.fillStyle = "black";
            ctx.textAlign = 'center';
            ctx.textBaseline = 'bottom';
            
            this.data.datasets.forEach(function (dataset)
            {
              for (var i = 0; i < dataset.data.length; i++) {
                for(var key in dataset._meta)
                {
                  var model = dataset._meta[key].data[i]._model;
                  ctx.fillText(dataset.data[i], model.x, model.y - 5);
                }
              }
            });
          }
        },
        animationEnabled: true,
        legend: {
          display: true
        },
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true,
              suggestedMax: 6
            }
          }]
        },
      }
    });
    $('#save-image-btn').click(function() {
      var canvas = document.getElementById("сhart");
      console.log(canvas)
    canvas.toBlob(function(blob) {
      saveAs(blob, "image.png");
    });
  });
  
</script>
{% endblock content %}
